#!/bin/bash

CURRENT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

cd "$ARCH_SETUP_PATH"
git pull
mapfile -t packages < <(grep -v '^#' ~/archsetup/base.packages)
paru -Syu --noconfirm --needed "${packages[@]}"


cd "$DOTFILES_PATH"
git pull
for dir in */; do
    [ -d "$dir" ] || continue
    dir=${dir%/}
    echo "Stowing $dir..."
    stow --target="$HOME" "$dir"
done

if [[ -f "$ARCHY_PATH/theme/theme.name" ]]; then
  CURRENT_THEME_NAME=$(cat "$/ARCY_PATH/theme/theme.name")
else
  CURRENT_THEME_NAME="catppuccin"
fi

set-theme "$CURRENT_THEME_NAME"
cd "$CURRENT_DIR"
