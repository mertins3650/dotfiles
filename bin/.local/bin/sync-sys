#!/bin/bash

pushd ~/archsetup/
git pull
mapfile -t packages < <(grep -v '^#' ~/archsetup/base.packages)
paru -Syu --noconfirm --needed "${packages[@]}"

popd

pushd ~/dotfiles/
git pull
for dir in */; do
    [ -d "$dir" ] || continue
    dir=${dir%/}
    echo "Stowing $dir..."
    stow --target="$HOME" "$dir"
done
popd

if [[ -f "$HOME/.local/share/theme/current/theme.name" ]]; then
  CURRENT_THEME_NAME=$(cat "$HOME/.local/share/theme/current/theme.name")
else
  CURRENT_THEME_NAME="catppuccin"
fi

set-theme "$CURRENT_THEME_NAME"
