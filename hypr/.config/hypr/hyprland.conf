# -- AUTO EXEC -------------------------------------------------------

exec-once = uwsm-app -- hypridle
exec-once = uwsm-app -- mako
exec-once = uwsm-app -- waybar
exec-once = uwsm-app -- fcitx5
exec-once = uwsm-app -- swaybg -i "$ARCHY_PATH"/theme/background.png -m fill
exec-once = uwsm-app -- swayosd-server
exec-once = /usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1
exec-once = arch-first-run

# Slow app launch fix -- set systemd vars
exec-once = systemctl --user import-environment $(env | cut -d'=' -f 1)
exec-once = dbus-update-activation-environment --systemd --all

source = ~/.local/share/archy/theme/hyprland.conf

# -- ENVIRONMENT VARIABLES -------------------------------------------------------

env = HYPRCURSOR_SIZE,24

# Force all apps to use Wayland
env = GDK_BACKEND,wayland,x11,*
env = QT_QPA_PLATFORM,wayland;xcb
env = QT_STYLE_OVERRIDE,kvantum
env = SDL_VIDEODRIVER,wayland
env = MOZ_ENABLE_WAYLAND,1
env = ELECTRON_OZONE_PLATFORM_HINT,wayland
env = OZONE_PLATFORM,wayland
env = XDG_SESSION_TYPE,wayland

# Allow better support for screen sharing (Google Meet, Discord, etc)
env = XDG_CURRENT_DESKTOP,Hyprland
env = XDG_SESSION_DESKTOP,Hyprland

xwayland {
  force_zero_scaling = true
}

# Use XCompose file
env = XCOMPOSEFILE,~/.XCompose

# Don't show update on first launch
ecosystem {
  no_update_news = true
}

# -- MONITORS -------------------------------------------------------
env = GDK_SCALE,2

monitor=,preferred,auto,1
monitor=DP-2,2560x1440@144,0x0,1
monitor=eDP-1,preferred,auto,1.25


# trigger when the switch is turning on
bindl = , switch:on:Lid Switch, exec, hyprctl keyword monitor "eDP-1, disable"
# trigger when the switch is turning off
bindl = , switch:off:Lid Switch, exec, hyprctl keyword monitor "eDP-1, preferred, auto, 1.6"

# -- INPUT -------------------------------------------------------

input {
    kb_layout = dk
    kb_variant =
    kb_model =
    kb_options =
    kb_rules =

    follow_mouse = 1

    sensitivity = 0 # -1.0 - 1.0, 0 means no modification.
    repeat_rate = 40
    repeat_delay = 600
    accel_profile = flat


    touchpad {
        natural_scroll = true
    }
}
misc {
    key_press_enables_dpms = true  # key press will trigger wake
    mouse_move_enables_dpms = true # mouse move will trigger wake
}

# -- PROGRAMS -------------------------------------------------------
$terminal = uwsm app -- $TERMINAL
$browser = launch-browser
$fileManager = nautilus
$menu = uwsm app -- rofi -show drun
$browser = launch-browser


# -- LOOK AND FEEL --------------------------------------------------

general {
    gaps_in = 5
    gaps_out = 10

    border_size = 2

    # https://wiki.hypr.land/Configuring/Variables/#variable-types for info about colors
    col.active_border = $color1 $color2 $color3 $color4 90deg
    # col.active_border = $rose $pine $love $iris 90deg
    col.inactive_border = rgba(595959aa)

    # Set to true enable resizing windows by clicking and dragging on borders and gaps
    resize_on_border = false

    # Please see https://wiki.hypr.land/Configuring/Tearing/ before you turn this on
    allow_tearing = false

    layout = dwindle
}

# -- DECORATION -------------------------------------------------------
decoration {
    rounding = 0

    shadow {
        enabled = true
        range = 2
        render_power = 3
        color = rgba(1a1a1aee)
    }

    # https://wiki.hyprland.org/Configuring/Variables/#blur
    blur {
        enabled = true
        size = 2
        passes = 2
        special = true
        brightness = 0.60
        contrast = 0.75
    }
}

# -- ANIMATIONS -------------------------------------------------------
# https://wiki.hypr.land/Configuring/Variables/#animations
animations {
    enabled = no
}


# -- LAYOUTS -------------------------------------------------------
dwindle {
    pseudotile = true
    preserve_split = true # You probably want this
    force_split = 2
}

# See https://wiki.hypr.land/Configuring/Master-Layout/ for more
master {
    new_status = master
}

# https://wiki.hypr.land/Configuring/Variables/#misc
misc {
    disable_hyprland_logo = true
    disable_splash_rendering  = true
    focus_on_activate = true
    anr_missed_pings = 3
    on_focus_under_fullscreen = 1

}

# -- KEYBNDINGS -------------------------------------------------------

$mainMod = SUPER # Sets "Windows" key as main modifier

# Programs
bind = $mainMod, Q, killactive,
bind = $mainMod, D, exec, $menu
bind = $mainMod, RETURN, exec, $terminal
bind = $mainMod CTRL, F, exec, uwsm app -- $fileManager --new-window
bind = $mainMod SHIFT, F, exec, $terminal -e yazi
bind = $mainMod, R, exec, $menu
bind = $mainMod SHIFT, B, exec, $browser
bind = $mainMod SHIFT ALT, B, exec, $browser --private
bind = $mainMod SHIFT, A, exec, launch-webapp "https://chatgpt.com"
bind = $mainMod SHIFT, Y, exec, launch-webapp "https://youtube.com/"
bind = $mainMod SHIFT, C, exec, launch-webapp "https://calendar.proton.me/"
bind = $mainMod SHIFT, E, exec, launch-webapp "https://mail.proton.me/"
bind = $mainMod SHIFT, N, exec, launch-webapp "https://netflix.com/"
bind = $mainMod SHIFT, T, exec, launch-webapp "https://twitch.tv/"
bind = $mainMod CTRL, J, exec, launch-webapp "http://10.20.100.5:8096"
bind = $mainMod CTRL, L, exec, uwsm app -- lmstudio

# Scripts
bind = $mainMod ALT, T, exec, floating-terminal theme-switcher
bind = $mainMod SHIFT, U, exec, floating-terminal sync-sys

# Control tiling
bind = $mainMod, T, togglefloating,
bind = $mainMod, P, pseudo, # dwindle
bind = $mainMod, V, togglesplit, # dwindle
bind = $mainMod, F, fullscreen, 0

# Move focus
bind = $mainMod, h, movefocus, l
bind = $mainMod, l, movefocus, r
bind = $mainMod, k, movefocus, u
bind = $mainMod, j, movefocus, d

# Move window
bind = $mainMod SHIFT, h, movewindow, l
bind = $mainMod SHIFT, l, movewindow, r
bind = $mainMod SHIFT, k, movewindow, u
bind = $mainMod SHIFT, j, movewindow, d

# Resize window
bind = $mainMod ALT, L, resizeactive, 10 0
bind = $mainMod ALT, H, resizeactive, -10 0
bind = $mainMod ALT, K, resizeactive, 0 -10
bind = $mainMod ALT, J, resizeactive, 0 10

# Switch workspaces
bind = $mainMod, 1, workspace, 1
bind = $mainMod, 2, workspace, 2
bind = $mainMod, 3, workspace, 3
bind = $mainMod, 4, workspace, 4
bind = $mainMod, 5, workspace, 5
bind = $mainMod, 6, workspace, 6
bind = $mainMod, 7, workspace, 7
bind = $mainMod, 8, workspace, 8
bind = $mainMod, 9, workspace, 9
bind = $mainMod, 0, workspace, 10

# Move active window to a workspace
bind = $mainMod SHIFT, 1, movetoworkspace, 1
bind = $mainMod SHIFT, 2, movetoworkspace, 2
bind = $mainMod SHIFT, 3, movetoworkspace, 3
bind = $mainMod SHIFT, 4, movetoworkspace, 4
bind = $mainMod SHIFT, 5, movetoworkspace, 5
bind = $mainMod SHIFT, 6, movetoworkspace, 6
bind = $mainMod SHIFT, 7, movetoworkspace, 7
bind = $mainMod SHIFT, 8, movetoworkspace, 8
bind = $mainMod SHIFT, 9, movetoworkspace, 9
bind = $mainMod SHIFT, 0, movetoworkspace, 10

#Media control
# Only display the OSD on the currently focused monitor
$osdclient = swayosd-client --monitor "$(hyprctl monitors -j | jq -r '.[] | select(.focused == true).name')"

# Laptop multimedia keys for volume and LCD brightness (with OSD)
bindeld = ,XF86AudioRaiseVolume, Volume up, exec, $osdclient --output-volume raise
bindeld = ,XF86AudioLowerVolume, Volume down, exec, $osdclient --output-volume lower
bindeld = ,XF86AudioMute, Mute, exec, $osdclient --output-volume mute-toggle
bindeld = ,XF86AudioMicMute, Mute microphone, exec, $osdclient --input-volume mute-toggle
bindeld = ,XF86MonBrightnessUp, Brightness up, exec, $osdclient --brightness raise
bindeld = ,XF86MonBrightnessDown, Brightness down, exec, $osdclient --brightness lower

# Precise 1% multimedia adjustments with Alt modifier
bindeld = ALT, XF86AudioRaiseVolume, Volume up precise, exec, $osdclient --output-volume +1
bindeld = ALT, XF86AudioLowerVolume, Volume down precise, exec, $osdclient --output-volume -1
bindeld = ALT, XF86MonBrightnessUp, Brightness up precise, exec, $osdclient --brightness +1
bindeld = ALT, XF86MonBrightnessDown, Brightness down precise, exec, $osdclient --brightness -1

# Lock screen
bind = $mainMod ALT, L, exec, dpidof hyprlock || hyprlock &

# Rezise windows with SUPER + RMB
bindmd = SUPER, mouse:273, Resize window, resizewindow

# -- WINDOWS AND WORKSPACES -------------------------------------------------------
workspace = w[tv1], gapsout:0, gapsin:0
workspace = f[1], gapsout:0, gapsin:0
windowrule {
    name = no-gaps-wtv1
    match:float = false
    match:workspace = w[tv1]

    border_size = 0
    rounding = 0
}

windowrule {
    name = no-gaps-f1
    match:float = false
    match:workspace = f[1]

    border_size = 0
    rounding = 0
}
windowrule {
    # Ignore maximize requests from all apps. You'll probably like this.
    name = suppress-maximize-events
    match:class = .*

    suppress_event = maximize
}

windowrule {
    # Fix some dragging issues with XWayland
    name = fix-xwayland-drags
    match:class = ^$
    match:title = ^$
    match:xwayland = true
    match:float = true
    match:fullscreen = false
    match:pin = false

    no_focus = true
}

# Hyprland-run windowrule
windowrule {
    name = move-hyprland-run

    match:class = hyprland-run

    move = 20 monitor_h-120
    float = yes
}

windowrule = opacity 1 0.95, match:class .*

# Floating windows
windowrule = float on, match:tag floating-window
windowrule = center on, match:tag floating-window
windowrule = size 875 600, match:tag floating-window

windowrule = tag +floating-window, match:class (org.archy.bluetui|org.archy.impala|org.archy.wiremix|org.archy.btop|org.archy.terminal|org.archy.bash|org.gnome.NautilusPreviewer|org.gnome.Evince|com.gabm.satty|archy|About|TUI.float|imv|mpv)
windowrule = tag +floating-window, match:class (xdg-desktop-portal-gtk|sublime_text|DesktopEditors|org.gnome.Nautilus), match:title ^(Open.*Files?|Open [F|f]older.*|Save.*Files?|Save.*As|Save|All Files|.*wants to [open|save].*|[C|c]hoose.*)
windowrule = float on, match:class org.gnome.Calculator

# Float Steam
windowrule = float on, match:class steam
windowrule = center on, match:class steam, match:title Steam
windowrule = opacity 1 1, match:class steam
windowrule = size 1100 700, match:class steam, match:title Steam
windowrule = size 460 800, match:class steam, match:title Friends List
windowrule = idle_inhibit fullscreen, match:class steam
